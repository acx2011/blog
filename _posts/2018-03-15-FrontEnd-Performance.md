---
layout: post
title: 前端性能优化
tags: [Front-End]
---

**摘要：**前端面试几乎都会问这样一个问题：说说你对前端性能优化的了解。这个问题相当于是开卷考试了，因为也没啥标准答案。但是还是有一些常见套路的，这里就尝试着罗列一些，希望能总结越多，理解越多。
{:.message}

其实，基本的思路大致有这么三个方向：

1. 基于浏览器渲染页面原理上的 CSS、JavaScript 语法层面的优化
2. 针对 HTTP 协议特性上的网络层面的优化，如合并、压缩资源等
3. 针对用户体验层面的交互逻辑优化，如懒加载等

在当前计算机物理性能的快速发展下，只要代码写得不是特别过分，即使使用了第一点中更好的语法也不会对前端性能提升很多。而第二点则是必须持续要做的，同时第三点现在也成为了性能优化的主要发力点。基于以上后两点的思路，常见的手段和实践主要有以下几个方面：

## 网页内容

### 减少 http 请求次数

减少页面中的资源请求次数是缩短网页响应时间的关键。常见的技巧有：

+ 捆绑文件： 将多个脚本或样式文件打包成一个文件。
+ CSS Sprites：将多张图片拼成一张图片，由 CSS 控制局部图片的显示。
+ base64 转换：将较小的图片通过 base64 转换为字符串以减少 http 请求。

### 减少 DNS 查询次数

DNS 查询也会消耗响应时间。如果网页内容来自多个不同的 domain，那么浏览器首次解析这些 domain 就需要消耗一定的时间。所以我们应该尽可能少地使用外部资源或保持外部域名的少样性。

### 减少 302 和 404

有时 302 的重定向是多种因素导致的，比如说服务转移、业务需要。但是从用户角度考虑，一次请求之后的多次页面跳转会带来更多的等待时间，这种等待会覆盖我们在技术层面种种优化尝试。同理， 404 的错误也应该尽量避免。

### 优化 Ajax

常见的技巧有：

+ 添加 `Expires` 或 `Cache-Control` 报文头使响应可以被客户端缓存
+ 压缩响应内容
+ 减少 DNS 查询

### 延迟加载、提前加载

延迟加载是基于我们知道网页最初加载需要的最小内容集是什么，剩下的内容就可以加入延迟加载的集合中。JavaScript 是典型的可以延迟加载的内容。

提前加载则是为了提前加载接下来网页中访问的资源。

### 减少 DOM 元素数量

网页中过多的 DOM 元素对网页的加载和脚本的执行都是沉重的负担。通过 `document.getElementsByTagName('*').length` 便可计算出页面中 DOM 元素的数量。

### 根据域名划分内容

浏览器一般对同一个域的下载连接数有所限制，按照域名划分下载内容可以增大并行下载连接数。但是注意控制域名数量在 2-4 个之间，不然 DNS 查询也是个问题。一般网站规划会将静态资源放在类似于 static.example.com 或 CDN 上，动态内容放在 www.example.com 上。这样做还有一个好处是可以在静态的域名上避免使用 cookie。

### 减少 iframe 数量

使用 iframe 要注意理解 iframe 的优缺点：

优点：

+ 可以用来加载速度较慢的内容，例如广告。
+ 安全沙箱保护。浏览器会对 iframe 中的内容进行安全控制。
+ 脚本可以并行下载。

缺点：

+ 即使 iframe 内容为空也会消耗加载时间。
+ 会阻止页面加载。

## 服务器

### 使用 CDN

前端性能优化的第一定律就是减少网页内容的下载时间。而提高下载速度可以通过 CDN 来提升。

### 添加 Expires 或 Cache-Control 报文头

对静态内容添加 `Expires`，可以将静态内容设为永不过期，或者很长时间以后。对动态内容应用合适的 `Cache-Control`，可以让浏览器根据条件来发送请求。

### Gzip 压缩传输文件

Gzip 通常可以减少网页内容 70% 的大小，包括脚本、样式表、图片等文件，主流服务器都有相应的压缩支持模块。

###  使用 GET Ajax 请求

浏览器在实现 XMLHttpRequest POST 的时候分成两步，先发 header，然后发送数据。而 GET 却可以用一个 TCP 报文完成请求，所以使用 Ajax 请求数据时尽量通过 GET 来完成。

### 避免空的图片 src

空的图片 src 仍然会使浏览器发送请求到服务器，这样完全是浪费时间，而且浪费服务器的资源。